language: java
jdk:
  - oraclejdk8
install: true

env:
  global:
  - secure: "uMjedZD3EUoSP8Mj7L2IgYRy0rOvvuJfIx9GYlx13u2j4Zj8c+zTBRGpkldqx4rvNweqejgCLnkrwc2fS4X6GtpE4nab43141QicCv/hhqzQVN3Z+5mcW6r+kSBqgwfwgvnrcj0kNnPXje7rF/D5Wuw7BHCV3Vmcl7DZ2EnNVe0j/AMQMefMrf/d1X14rwNvAnO2B9ngaJET9txgVeTAjFUaAPA+83v2XGGPbYrgEkHdVO5HikHwEfyeB4mWgCCj9LLg/HyoEewt9Nt6kMtzuXYGNarypUqoCqinzch87BrrQZAb9esTZo8+pjROsficeboiWrEI0zQObYPxQVvuv2stDh85W8Z80VsSHj/9J7VDljSTzQTHdWVfa2DVpH0BHJdqCVgVy6+AXshWIyKeIZUbcWQfkd73Edql8CA9+k+docYc8GB5KnsKzq7/czvpiBEFVwCEbwLhuLr0Ag3HfgEoM3y+J25VXuBOqTGugihhXnpwoxj4oNAMNl8tWQHD04Wv1iKirJjXAZGUp0Q1grhElKxivDqdKBbvBdL/fMyiOQEOBtv6UZe1BcV8fVru9JhdIpEh1BgOUpENA6Cu4jKEgFgNMCphR9Au8c2QkvlZfwlocwm/txjLrRUpLGcnpdCY2lrvoLdBxas/urTX51mlTKGoVhnvd4WbR9dq9/I="
  - dockeruser: "JymcSKeT3lYL65yZ66biT0h6xQKpaQtV6lESe3Pb5CXJURUc6P68KU8AV3RBBlDbUm4J5+EsN+qITIciYMnhK1bITsgvSmX0qf4MUgu3cG35jMDz9hRBiJG8lsXHyzokeYK8AgWzy+2V1FZpfwcedzEuyoRiN0ygKecprVutHnGxPo4mFE4Dacp8Yu+DV7adtEdYEEZL327VF0A756BltA6ZqtlxNhuq7CVk7WsbvM/8gr3D5TNJH4D+q9G5wxYyoUDUzZx0IP/wE1slWCg1Vmy2s4ldsJ1k0P4OrxZfhPkBk0czBd1wcLltI2bJKRpqgXTC/J3Q8sxycTGFLuZl83D19HZrFgHQbbV5zuo6KkLvokOY3fPa0EPRciT148yqpzoRZFczppV0AtIgjHDGubVq6BF61dCi75m5x9te/RLPIT343LH9YmqcM8oDFpjBUX9iZApfOzMsdCZKv6j70CBXhHjd8OwLCbkp5Qn3IpWM7rvmnV90BzF3OhOV4h0QQCZCBOKNS4OD6Vob/0+Z/smstVhqWlc2JW+ylTKuFDm1okSfd/tireUELgLYSbykTwWORF4Rb5+2etVMMAfa4sYcUfLhHDS0ZRSBIABa77dwHllsfKh+EFDeShpPN5Uzw38PRk+c5J1rpn+Fcljnnn3I/587wRY+ssH3FbvTgcQ="
  - dockerpassword: "Pu6qCxj9ZwJyrSy2Bv+nt8kZqMOif834Th21jypzUXz6rWWZfXRAv3HUauXfeRrYS1bUTcHti0T5HgD3o8cpcZfEe27zDczEoAOFjm9ATpXFu6+vhuhMTejtzj8wgLzxbWXgEzVMiXqMap774hA/pLdZNV4qGKf7q3kBr9vHRFuyfY/Gz66PjJ0RlwxKBS4CxPgNqv4fsE6Pleky5XuuSs9RETjhfkpXouxoJx0HOkkOenBlSIyrR42dX4WiaZBbsMSOCNPWzv9D6r44t7++Z2Z7nV/tUXm1gK8Rq5w4QUZfhyC8D/pL7tfdhMogDDHfIBuSFniDutHv+1/J3zWtk5V8V875Mc7ZXir8nIEXRWpju65PxJikbSkE4BaDKPWejgCeTueFyqpKxw8+vIt95aWtBt9GjNR7O00FduHsua+m3IeDUJHkbMaBCR5jauvPnThmaCrGBly0D7lxUULMMQ3DGs4WOmsoFkx+BS5ykYqclyfh1Hc5Sf66U8go/wZg6vzvikBccDI+lupc3uHbzH14b+vQYxYQ7MATkG4junBSm4Bw5+eJ6Imx6SULqVNftyDJsIeW1NC6GgSElsUVFNAxcS/3rbiFQdJwLBsIO1jbqk/zw4+TEyMX+JcGF9wAGC5quhRWncxv/IhevQBocOzT8dg7iN/Rh5Hhj+rdAH0="

addons:
  sonarcloud:
    organization: harishkadamudi-github
    token:
      secure: $SONAR_TOKEN

script:
  - mvn clean install
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar

cache:
  directories:
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'

sudo: required
#dist: trusty

services:
  - docker

#dist: trusty
#jobs:
#  include:
#    - stage: build docker image
#      script:
#      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
#      - docker images
#      - docker build -t com.eizzy.recharge.rest:latest -f Dockerfile .
#      - docker images
#      - docker tag eizzy-recharge_rest $DOCKER_USERNAME/eizzy-recharge_rest
#      - docker push $DOCKER_USERNAME/eizzy-recharge_rest
    #- stage: test
    #  script: docker run --rm $DOCKER_USERNAME/travis-ci-build-stages-demo cat hello.txt
    #- script: docker run --rm $DOCKER_USERNAME/travis-ci-build-stages-demo cat hello.txt

after_success:
  - docker login -u $dockeruser -p $dockerpassword#
  - export TAG=`if [ "$TRAVIS_BRANCH" == "develop" || "$TRAVIS_BRANCH" == "master"]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
  - export IMAGE_NAME=harishkadamui/recharge-rest
  - docker build -t $IMAGE_NAME:$COMMIT -f Dockerfile .
  - docker tag $IMAGE_NAME:latest
  - docker push $IMAGE_NAME